<html>
<head>
<title>Web SQL database example</title>

<script>

// Web SQL database
var db = null;

function initApp(){
  console.log("initialise app");

  try{
    db = openDatabase('taskdb', '1.0', 'Task DB', 2 * 1024 * 1024);
  }catch(ignore){
    console.error("local DB is not supported");
  }

  if(db != null){

    db.transaction(
      function (transaction) {
        transaction.executeSql(
          'CREATE TABLE IF NOT EXISTS TO_DO(TASK TEXT NOT NULL, URGENCY TEXT NOT NULL);', 
          null, 
          null,
          errorHandler
        );
      }
    );

  }
}

// a generic error handler for db
function errorHandler(transaction, error){
  console.error("Error: " + error.code + ": " + error.message);
}

function addTask(){
  var taskInput = document.getElementById("task");
  var task = taskInput.value;

  var urgencySelect = document.getElementById("urgency");
  var urgency = urgencySelect.value;

  dbInsertTask(task, urgency);
}

function dbInsertTask(task, urgency){
  //save task to database
  if(db != null){
    db.transaction(
      function (transaction) {
        transaction.executeSql(
          'INSERT INTO TO_DO (TASK, URGENCY) VALUES (?, ?);', 
          [task, urgency], 
          null,
          errorHandler
        );
      }
    );
  }
}

function showTask(){

  if(db != null){
    db.transaction(
      function (transaction) {
        transaction.executeSql(
          'select * from TO_DO;', 
          null, 
          displayTasks,
          errorHandler
        );
      }
    );
  }

}

function displayTasks(transaction, results){
  var taskList = results.rows;
  var display = document.getElementById('display');
  display.innerHTML = '';
  for(var x = 0; x < taskList.length; x++)
  {
    display.innerHTML += '<ul> ' + taskList[x].TASK + "<br /> URGENCY: " + taskList[x].URGENCY + '</ul> <br />';
    console.log(taskList.value);
  }
}

</script>

</head>

<body onLoad="initApp()">

<h1>To Do List</h1>

Task:
<input type="text" id="task" />

Urgency:
<select id="urgency">
  <option value="Low">Low</option>
  <option value="Medium">Medium</option>
  <option value="High">High</option>
</select>

<button onClick="addTask()">
Add
</button>

<button onClick="showTask()">
Show tasks
</button>
<br />
<div id="display"></div>

</body>

</html>